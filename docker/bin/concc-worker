#!/bin/sh

MOUNT_SH=/tmp/mount.sh
PASSWORD=/tmp/password

SSH_MAX_SESSIONS=${CONCC_MAX_JOBS:-$(nproc)}
sed -i "s|#MaxSessions .*|MaxSessions $SSH_MAX_SESSIONS|" /etc/ssh/sshd_config
/etc/init.d/ssh start

while true
do
  if [ -f $MOUNT_SH ] && [ -f $PASSWORD ]
  then
    break
  else
    sleep 1
  fi
done

touch /tmp/ready

echo "Mounting the workspace directory..."
sh $MOUNT_SH
