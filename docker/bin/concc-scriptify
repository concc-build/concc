#!/opt/concc/bin/python3

import os
import shlex
import sys

EXCLUDED_ENVS = [
  '_',
  'HOSTNAME',
  'PWD',
  'LC_CTYPE',
  'CONCC_DEBUG_DISPATCH',
  'CONCC_DEBUG_SCRIPTIFY',
  'CONCC_RUN_LOCALLY',
]

cmd = ' '.join([shlex.quote(arg) for arg in sys.argv[1:]])

debug = False
if os.environ.get('CONCC_DEBUG_SCRIPTIFY') == '1':
  debug = True

script = []

if debug:
  script.append('set -x')

script.append('cd {}'.format(os.getcwd()))

for k, v in os.environ.items():
  if k in EXCLUDED_ENVS:
    continue
  script.append('export {}={}'.format(k, shlex.quote(v)))

script.append('{}'.format(cmd))

script = '\n'.join(script)
print('{}'.format(script))
