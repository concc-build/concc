#!/bin/sh

if [ "$CONCC_DEBUG_DISPATCH" = 1 ]
then
  set -x
fi

WORKER=$(concc-worker-pool allocate)
trap "concc-worker-pool release $WORKER" EXIT
WORKER_HOST=$(echo $WORKER | cut -d ':' -f 1)
WORKER_PORT=$(echo $WORKER | cut -d ':' -f 2)
concc-scriptify "$@" | ssh -p $WORKER_PORT $WORKER_HOST sh -s
